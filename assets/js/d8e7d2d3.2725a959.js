"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[410],{8216:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"integracoes/integracao-via-dll/csharp/estorno","title":"Estorno","description":"Esta p\xe1gina explica como utilizar a fun\xe7\xe3o desfazerTransacao da ConnectTEF.dll para realizar o estorno (cancelamento) de uma transa\xe7\xe3o previamente aprovada.","source":"@site/docs/integracoes/integracao-via-dll/csharp/estorno.md","sourceDirName":"integracoes/integracao-via-dll/csharp","slug":"/integracoes/integracao-via-dll/csharp/estorno","permalink":"/docs/integracoes/integracao-via-dll/csharp/estorno","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Pagamento","permalink":"/docs/integracoes/integracao-via-dll/csharp/pagamento"},"next":{"title":"Guia de ativa\xe7\xe3o","permalink":"/docs/category/guia-de-ativa\xe7\xe3o"}}');var o=r(4848),s=r(8453);const t={sidebar_position:2},i="Estorno",c={},d=[{value:"Fun\xe7\xe3o Utilizada",id:"fun\xe7\xe3o-utilizada",level:2},{value:"Exemplo",id:"exemplo",level:2},{value:"Exemplo de Retorno",id:"exemplo-de-retorno",level:2},{value:"Campos Relevantes",id:"campos-relevantes",level:2}];function l(n){const e={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"estorno",children:"Estorno"})}),"\n",(0,o.jsxs)(e.p,{children:["Esta p\xe1gina explica como utilizar a fun\xe7\xe3o ",(0,o.jsx)(e.code,{children:"desfazerTransacao"})," da ",(0,o.jsx)(e.code,{children:"ConnectTEF.dll"})," para realizar o estorno (cancelamento) de uma transa\xe7\xe3o previamente aprovada."]}),"\n",(0,o.jsx)(e.h2,{id:"fun\xe7\xe3o-utilizada",children:"Fun\xe7\xe3o Utilizada"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-c",children:"const char* desfazerTransacao(const char* identificacao, const char* numeroTransacao);\n"})}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:(0,o.jsx)(e.code,{children:"identificacao"})}),": string (at\xe9 10 caracteres) \u2013 Identificador \xfanico da solicita\xe7\xe3o de estorno"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:(0,o.jsx)(e.code,{children:"numeroTransacao"})}),": string \u2013 NSU da transa\xe7\xe3o original que ser\xe1 estornada"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Retorno"}),": string JSON com o resultado da opera\xe7\xe3o"]}),"\n"]}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"exemplo",children:"Exemplo"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'using System;\r\nusing System.Runtime.InteropServices;\r\nusing Newtonsoft.Json.Linq;\r\n\r\nclass Program\r\n{\r\n    // Importa a fun\xe7\xe3o de estorno da DLL\r\n    [DllImport("ConnectTEF.dll", CallingConvention = CallingConvention.Cdecl)]\r\n    public static extern IntPtr desfazerTransacao(string identificacao, string numeroTransacao);\r\n\r\n    // Fun\xe7\xe3o auxiliar para converter o ponteiro retornado em string JSON\r\n    private static string Executar(Func<IntPtr> chamadaDLL)\r\n    {\r\n        IntPtr ptr = chamadaDLL();\r\n        string json = Marshal.PtrToStringAnsi(ptr);\r\n        Marshal.FreeHGlobal(ptr);\r\n        return json;\r\n    }\r\n\r\n    static void Main()\r\n    {\r\n        try\r\n        {\r\n            // Exemplo: Estornar a transa\xe7\xe3o com NSU 429213502001\r\n            string identificacao = "estorno01";\r\n            string nsuOriginal = "429213502001";\r\n\r\n            Console.WriteLine("\ud83d\udfe1 Iniciando estorno...");\r\n\r\n            string respostaJson = Executar(() => desfazerTransacao(identificacao, nsuOriginal));\r\n            JObject resposta = JObject.Parse(respostaJson);\r\n\r\n            string status = resposta["statusTransacao"]?.ToString();\r\n            string mensagem = resposta["textoEspecialOperador"]?.ToString() ?? "(sem mensagem)";\r\n\r\n            Console.WriteLine($"\ud83d\udd04 Resposta da TEF: {mensagem}");\r\n\r\n            if (status == "0")\r\n            {\r\n                Console.WriteLine("\u2705 Estorno realizado com sucesso!");\r\n                Console.WriteLine($"\ud83d\udccb NSU Estornado: {resposta["numeroTransacaoCancelada"]}");\r\n                Console.WriteLine($"\ud83d\udcc5 Data: {resposta["dataTransacaoComprovante"]}");\r\n                Console.WriteLine($"\u23f1\ufe0f Hora: {resposta["horaTransacaoComprovante"]}");\r\n            }\r\n            else\r\n            {\r\n                Console.WriteLine("\u274c Falha no estorno.");\r\n                Console.WriteLine($"\ud83d\udd0e C\xf3digo do status: {status}");\r\n            }\r\n        }\r\n        catch (Exception ex)\r\n        {\r\n            Console.WriteLine($"\ud83d\udea8 Erro inesperado: {ex.Message}");\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"exemplo-de-retorno",children:"Exemplo de Retorno"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-json",children:'{\r\n  "identificacao": "estorno01",\r\n  "statusTransacao": "0",\r\n  "numeroTransacaoCancelada": "429213502001",\r\n  "timestampTransacaoCancelada": "1810102912",\r\n  "dataTransacaoComprovante": "18102024",\r\n  "horaTransacaoComprovante": "102912",\r\n  "textoEspecialOperador": "Transa\xe7\xe3o estornada com sucesso",\r\n  "comprovante": "...",\r\n  "nomeAdministradora": "PAYWAVE/VISA",\r\n  "bandeiraCartao": "VISA"\r\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"campos-relevantes",children:"Campos Relevantes"}),"\n",(0,o.jsxs)(e.table,{children:[(0,o.jsx)(e.thead,{children:(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.th,{children:"Campo"}),(0,o.jsx)(e.th,{children:"Descri\xe7\xe3o"})]})}),(0,o.jsxs)(e.tbody,{children:[(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"statusTransacao"})}),(0,o.jsxs)(e.td,{children:[(0,o.jsx)(e.code,{children:'"0"'})," indica estorno bem-sucedido"]})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"numeroTransacao"})}),(0,o.jsx)(e.td,{children:"NSU da transa\xe7\xe3o (refer\xeancia \xfanica)"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"numeroTransacaoCancelada"})}),(0,o.jsx)(e.td,{children:"NSU da transa\xe7\xe3o que foi estornada"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"dataTransacaoComprovante"})}),(0,o.jsx)(e.td,{children:"Data do estorno (formato: ddMMyyyy)"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"horaTransacaoComprovante"})}),(0,o.jsx)(e.td,{children:"Hora do estorno (formato: hhmmss)"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"textoEspecialOperador"})}),(0,o.jsx)(e.td,{children:"Mensagem descritiva da opera\xe7\xe3o"})]})]})]})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(l,{...n})}):l(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>t,x:()=>i});var a=r(6540);const o={},s=a.createContext(o);function t(n){const e=a.useContext(s);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:t(n.components),a.createElement(s.Provider,{value:e},n.children)}}}]);