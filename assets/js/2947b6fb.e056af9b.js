"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[4903],{375:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"integracoes/integracao-via-dll/csharp/pagamento","title":"Pagamento","description":"Este exemplo demonstra como integrar a fun\xe7\xe3o executarTransacao da ConnectTEF.dll em um projeto C# para realizar um pagamento TEF.","source":"@site/docs/integracoes/integracao-via-dll/csharp/pagamento.md","sourceDirName":"integracoes/integracao-via-dll/csharp","slug":"/integracoes/integracao-via-dll/csharp/pagamento","permalink":"/docs/integracoes/integracao-via-dll/csharp/pagamento","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Exemplos C#","permalink":"/docs/category/exemplos-c"},"next":{"title":"Estorno","permalink":"/docs/integracoes/integracao-via-dll/csharp/estorno"}}');var o=r(4848),t=r(8453);const s={sidebar_position:1},i="Pagamento",c={},d=[{value:"Pr\xe9-requisitos",id:"pr\xe9-requisitos",level:2},{value:"Fun\xe7\xe3o Utilizada",id:"fun\xe7\xe3o-utilizada",level:2},{value:"Exemplo de C\xf3digo em C#",id:"exemplo-de-c\xf3digo-em-c",level:2},{value:"\ud83d\udce5 Exemplo de Retorno JSON (Sucesso)",id:"-exemplo-de-retorno-json-sucesso",level:2},{value:"\ud83d\udd0d Campos Importantes",id:"-campos-importantes",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"pagamento",children:"Pagamento"})}),"\n",(0,o.jsxs)(n.p,{children:["Este exemplo demonstra como integrar a fun\xe7\xe3o ",(0,o.jsx)(n.code,{children:"executarTransacao"})," da ",(0,o.jsx)(n.code,{children:"ConnectTEF.dll"})," em um projeto C# para realizar um pagamento TEF."]}),"\n",(0,o.jsx)(n.h2,{id:"pr\xe9-requisitos",children:"Pr\xe9-requisitos"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ConnectTEF.dll"})," dispon\xedvel no diret\xf3rio da aplica\xe7\xe3o"]}),"\n",(0,o.jsxs)(n.li,{children:["Projeto C# com suporte a chamadas nativas (",(0,o.jsx)(n.code,{children:"System.Runtime.InteropServices"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:["Pacote ",(0,o.jsx)(n.a,{href:"https://www.nuget.org/packages/Newtonsoft.Json/",children:"Newtonsoft.Json"})," instalado para manipular o JSON"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"fun\xe7\xe3o-utilizada",children:"Fun\xe7\xe3o Utilizada"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:"const char* executarTransacao(const char* identificacao, int valor_total);\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"identificacao"})}),": ID \xfanico da opera\xe7\xe3o (m\xe1ximo 10 caracteres)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"valor_total"})}),": valor da transa\xe7\xe3o em centavos (Ex: R$ 10,00 \u2192 ",(0,o.jsx)(n.code,{children:"1000"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Retorno"}),": string JSON com o resultado da opera\xe7\xe3o"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"exemplo-de-c\xf3digo-em-c",children:"Exemplo de C\xf3digo em C#"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'using System;\r\nusing System.Runtime.InteropServices;\r\nusing Newtonsoft.Json.Linq;\r\n\r\nclass Program\r\n{\r\n    // Importa a fun\xe7\xe3o da DLL\r\n    [DllImport("ConnectTEF.dll", CallingConvention = CallingConvention.Cdecl)]\r\n    public static extern IntPtr executarTransacao(string identificacao, int valor_total);\r\n\r\n    // Fun\xe7\xe3o auxiliar para converter o ponteiro retornado em string JSON\r\n    private static string Executar(Func<IntPtr> chamadaDLL)\r\n    {\r\n        IntPtr ptr = chamadaDLL();\r\n        string json = Marshal.PtrToStringAnsi(ptr);\r\n\r\n        // Libera a mem\xf3ria alocada pela DLL (se aplic\xe1vel)\r\n        Marshal.FreeHGlobal(ptr);\r\n\r\n        return json;\r\n    }\r\n\r\n    static void Main()\r\n    {\r\n        try\r\n        {\r\n            string identificacao = "abc123"; // ID \xfanico da transa\xe7\xe3o\r\n            int valor = 1000; // Valor em centavos (R$10,00)\r\n\r\n            Console.WriteLine("\ud83d\udfe1 Iniciando pagamento...");\r\n\r\n            string respostaJson = Executar(() => executarTransacao(identificacao, valor));\r\n            JObject resposta = JObject.Parse(respostaJson);\r\n\r\n            string status = resposta["statusTransacao"]?.ToString();\r\n            string mensagem = resposta["textoEspecialOperador"]?.ToString() ?? "(sem mensagem)";\r\n\r\n            Console.WriteLine($"\ud83d\udd04 Resposta da TEF: {mensagem}");\r\n\r\n            if (status == "0")\r\n            {\r\n                Console.WriteLine("\u2705 Pagamento realizado com sucesso!");\r\n                Console.WriteLine($"\ud83e\uddfe Comprovante: {resposta["comprovante"]?.ToString()?.Substring(0, 40)}...");\r\n                Console.WriteLine($"\ud83d\udccb NSU: {resposta["numeroTransacao"]}");\r\n                Console.WriteLine($"\ud83c\udfe6 Operadora: {resposta["nomeAdministradora"]}");\r\n                Console.WriteLine($"\ud83d\udcb3 Bandeira: {resposta["bandeiraCartao"]}");\r\n            }\r\n            else\r\n            {\r\n                Console.WriteLine("\u274c Falha na transa\xe7\xe3o.");\r\n                Console.WriteLine($"\ud83d\udd0e C\xf3digo do status: {status}");\r\n            }\r\n        }\r\n        catch (Exception ex)\r\n        {\r\n            Console.WriteLine($"\ud83d\udea8 Erro inesperado: {ex.Message}");\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"-exemplo-de-retorno-json-sucesso",children:"\ud83d\udce5 Exemplo de Retorno JSON (Sucesso)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "identificacao": "abc123",\r\n  "valorTotal": "1000",\r\n  "statusTransacao": "0",\r\n  "nomeRede": "PAGSEGURO",\r\n  "tipoTransacao": "20",\r\n  "numeroTransacao": "429213502001",\r\n  "codigoAutorizacaoTransacao": "226729",\r\n  "timestampTransacaoHost": "1810102912",\r\n  "quantidadeParcelas": "1",\r\n  "dataTransacaoComprovante": "18102024",\r\n  "horaTransacaoComprovante": "102912",\r\n  "nomeAdministradora": "PAYWAVE/VISA",\r\n  "bandeiraCartao": "VISA",\r\n  "razaoSocial": "PADARIA FAMILIA DOCES E SALGADOS",\r\n  "cnpj": "63500440000128",\r\n  "comprovante": "...",\r\n  "quantidadeLinhasComprovante": "15",\r\n  "finalizacao": "100C7E7E58|DD7AA030DC49419389D01CDC15566FF7"\r\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-campos-importantes",children:"\ud83d\udd0d Campos Importantes"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Campo"}),(0,o.jsx)(n.th,{children:"Descri\xe7\xe3o"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"statusTransacao"})}),(0,o.jsxs)(n.td,{children:[(0,o.jsx)(n.code,{children:'"0"'})," indica sucesso; qualquer outro valor indica falha"]})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"numeroTransacao"})}),(0,o.jsx)(n.td,{children:"NSU da transa\xe7\xe3o (refer\xeancia \xfanica)"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"codigoAutorizacaoTransacao"})}),(0,o.jsx)(n.td,{children:"C\xf3digo de autoriza\xe7\xe3o da operadora"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"bandeiraCartao"})}),(0,o.jsx)(n.td,{children:"Ex: VISA, MASTERCARD"})]})]})]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>i});var a=r(6540);const o={},t=a.createContext(o);function s(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);